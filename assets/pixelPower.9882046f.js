import{_ as V,r as _,c as N,o as $,b as a,g as u,d as o,e as g,t as d,af as D,h as Q,v as X,i as K,j as m,F as L,q as P,ag as j,a1 as M,ah as T,ai as z,aj as E,ak as O,al as U,am as Y,y as l}from"./index.be84e892.js";import{b as W}from"./route-block.6a611cbf.js";const ee={class:"mx-auto p-4"},te={key:0,class:"text-center py-8"},se={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"},oe={key:2},ne={class:"mb-6 flex flex-row mt-8"},re={class:"mb-4 text-sm text-gray-400 text-center flex justify-between items-center"},ae={key:0,class:"ml-4 text-xs"},le={class:"masonry-grid"},ie={class:"bg-gray-800 rounded-lg overflow-hidden shadow-lg hover:shadow-2xl hover:shadow-purple-500/50 transition-all duration-300"},ce={class:"relative overflow-hidden bg-gray-900"},de=["src","alt"],ue={class:"absolute inset-0 bg-black/70 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center p-4"},ge={class:"text-white text-sm text-center line-clamp-6"},me={class:"p-4"},pe={class:"text-xs text-gray-400 mb-2 flex items-center gap-2"},fe={class:"space-y-2"},he={key:0,class:"mt-2 p-2 bg-blue-900/30 rounded text-sm text-blue-200 border-l-2 border-blue-400"},ye={key:1,class:"mt-2"},ve={class:"flex flex-wrap gap-1 mt-1"},we={class:"text-xs text-gray-500 mt-2"},xe={class:"mt-2 space-y-1 pl-2 border-l-2 border-purple-500/30"},_e={key:0},Ie={key:1},be={key:2,class:"text-red-400/70"},Se={key:0,class:"text-center py-12 text-gray-400"},y="zoskyCube_generatedImages",B={__name:"pixelPower",setup(De){const p=_([]),I=_(!0),v=_(null),f=_(""),k=N(()=>{const s=localStorage.getItem(y);if(s){const e=JSON.parse(s);return new Date(e.lastUpdated).toLocaleString()}return null});async function R(){try{I.value=!0,v.value=null;const s=localStorage.getItem(y);if(s){const e=JSON.parse(s);p.value=e.records,console.log(`\u{1F4E6} Loaded ${e.records.length} cached images`);const t=e.newestTimestamp,n=await H(t);if(n.length>0){console.log(`\u{1F195} Found ${n.length} new images`);const r=q(e.records,n);p.value=r,A(r)}else console.log("\u2705 Cache is up to date")}else{console.log("\u{1F504} No cache found, fetching all images");const e=await G();p.value=e,e.length>0&&A(e)}}catch(s){console.error("\u274C Error fetching images:",s),v.value=`Failed to load images: ${s.message}`}finally{I.value=!1}}async function G(){const s=j(M,"generatedImages"),e=T(s,E("createdAt","desc"),z(500)),t=await O(e),n=[];return t.forEach(r=>{const i=r.data();n.push(Z(r.id,i))}),b(n)}async function H(s){const e=j(M,"generatedImages");let t;s instanceof U?t=s.toDate():(t=new Date(s),isNaN(t.getTime())&&(t=new Date(Date.now()-7*24*60*60*1e3)));const n=U.fromDate(t),r=T(e,Y("createdAt",">",n),E("createdAt","desc"),z(100)),i=await O(r),c=[];return i.forEach(h=>{const w=h.data();c.push(Z(h.id,w))}),console.log(`\u{1F4E5} Fetched ${c.length} images newer than ${s}`),b(c)}function Z(s,e){var t,n,r,i;return{id:s,downloadURL:e.downloadURL,filename:e.filename,createdAt:e.createdAt,prompt:((t=e.parameters)==null?void 0:t.prompt)||e.prompt||"",negative_prompt:((n=e.parameters)==null?void 0:n.negative_prompt)||"",guidance_scale:(r=e.parameters)==null?void 0:r.guidance_scale,num_inference_steps:(i=e.parameters)==null?void 0:i.num_inference_steps,generatedSentence:e.generatedSentence||"",words:e.words||[]}}function q(s,e){const n=[...e,...s].reduce((r,i)=>(r.find(c=>c.id===i.id)||r.push(i),r),[]);return b(n)}function b(s){return s.sort((e,t)=>{var i,c,h,w,x,C;const n=((i=e.createdAt)==null?void 0:i.seconds)||((h=(c=e.createdAt)==null?void 0:c.getTime)==null?void 0:h.call(c))||0;return(((w=t.createdAt)==null?void 0:w.seconds)||((C=(x=t.createdAt)==null?void 0:x.getTime)==null?void 0:C.call(x))||0)-n})}function A(s){if(s.length===0)return;const e=s.slice(0,500),t=e[0].createdAt;let n;t!=null&&t.toDate?n=t.toDate().toISOString():t!=null&&t.seconds?n=new Date(t.seconds*1e3).toISOString():n=new Date(t).toISOString();const r={lastUpdated:new Date().toISOString(),newestTimestamp:n,records:e};try{localStorage.setItem(y,JSON.stringify(r)),console.log(`\u{1F4BE} Cached ${e.length} images (newest: ${n})`)}catch(i){if(i.name==="QuotaExceededError"){console.warn("\u26A0\uFE0F localStorage quota exceeded, clearing old cache"),localStorage.removeItem(y);try{localStorage.setItem(y,JSON.stringify(r))}catch(c){console.error("Failed to cache even after cleanup:",c)}}}}function F(s){if(!s)return"Unknown";let e;return s.toDate?e=s.toDate():s.seconds?e=new Date(s.seconds*1e3):e=new Date(s),isNaN(e.getTime())?"Invalid Date":e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}const S=N(()=>{if(!f.value)return p.value;const s=f.value.toLowerCase();return p.value.filter(e=>{var t,n;return((t=e.prompt)==null?void 0:t.toLowerCase().includes(s))||((n=e.filename)==null?void 0:n.toLowerCase().includes(s))})});function J(s){s.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjMzc0MTUxIi8+Cjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzZCNzI4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+SW1hZ2UgTm90IEZvdW5kPC90ZXh0Pgo8L3N2Zz4K"}return $(()=>{R()}),(s,e)=>(l(),a("div",ee,[u(I)?(l(),a("div",te,[...e[1]||(e[1]=[o("img",{src:D,alt:"Pixel Power Logo",class:"inline h-10 mb-1 mr-2"},null,-1),o("p",null,"Loading images...",-1)])])):u(v)?(l(),a("div",se,[e[2]||(e[2]=o("img",{src:D,alt:"Pixel Power Logo",class:"inline h-10 mb-1 mr-2"},null,-1)),g(" "+d(u(v)),1)])):(l(),a("div",oe,[o("div",ne,[e[3]||(e[3]=o("img",{src:D,alt:"Pixel Power Logo",class:"inline h-20 -mt-4 -mb-5 mr-2"},null,-1)),Q(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>K(f)?f.value=t:null),type:"search",placeholder:"Search by prompt or words...",class:"border-blue-900 bg-transparent w-full p-3 border rounded shadow focus:outline-none focus:ring focus:ring-purple-500"},null,512),[[X,u(f)]])]),o("div",re,[o("div",null,[g(" Showing "+d(u(S).length)+" of "+d(u(p).length)+" images ",1),u(k)?(l(),a("span",ae," (Cached: "+d(u(k))+") ",1)):m("",!0)])]),o("div",le,[(l(!0),a(L,null,P(u(S),t=>(l(),a("div",{key:t.id,class:"masonry-item group"},[o("div",ie,[o("div",ce,[o("img",{src:t.downloadURL,alt:t.prompt,class:"w-full h-auto object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy",onError:J},null,40,de),o("div",ue,[o("p",ge,d(t.prompt),1)])]),o("div",me,[o("div",pe,[e[4]||(e[4]=o("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),g(" "+d(F(t.createdAt)),1)]),o("div",fe,[t.generatedSentence?(l(),a("div",he,[e[5]||(e[5]=o("span",{class:"font-semibold"},"Generated Sentence:",-1)),e[6]||(e[6]=o("br",null,null,-1)),g(" "+d(t.generatedSentence),1)])):m("",!0),t.words&&t.words.length>0?(l(),a("div",ye,[e[7]||(e[7]=o("span",{class:"text-xs font-semibold text-gray-400"},"Words:",-1)),o("div",ve,[(l(!0),a(L,null,P(t.words,(n,r)=>(l(),a("span",{key:r,class:"px-2 py-0.5 bg-green-900/50 text-green-300 text-xs rounded"},d(n),1))),128))])])):m("",!0),o("details",we,[e[11]||(e[11]=o("summary",{class:"cursor-pointer hover:text-gray-300 transition-colors"}," Technical Details ",-1)),o("div",xe,[t.guidance_scale?(l(),a("div",_e,[e[8]||(e[8]=o("span",{class:"font-semibold"},"Guidance:",-1)),g(" "+d(t.guidance_scale),1)])):m("",!0),t.num_inference_steps?(l(),a("div",Ie,[e[9]||(e[9]=o("span",{class:"font-semibold"},"Steps:",-1)),g(" "+d(t.num_inference_steps),1)])):m("",!0),t.negative_prompt?(l(),a("div",be,[e[10]||(e[10]=o("span",{class:"font-semibold"},"Negative:",-1)),g(" "+d(t.negative_prompt),1)])):m("",!0)])])])])])]))),128))]),u(S).length===0?(l(),a("div",Se,[...e[12]||(e[12]=[o("p",{class:"text-lg"},"No images found",-1),o("p",{class:"text-sm"},"Try adjusting your search criteria",-1)])])):m("",!0)]))]))}};typeof W=="function"&&W(B);const Ae=V(B,[["__scopeId","data-v-c1f7b037"]]);export{Ae as default};
